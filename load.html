<!doctype html>
<!doctype html>
<html lang="fr">

    <head>
        <meta charset="UTF-8" />
        <title>/-> PatriMath <-/</title>

        <script type="text/javascript" src="script/phaser.js"></script>
        <script type="text/javascript" src="script/soundmanager2.js"></script>

        <script type="text/javascript" src="script/functions/matrixInit.js"></script>
        <script type="text/javascript" src="script/functions/matrixUtils.js"></script>
        <script type="text/javascript" src="script/functions/varInit.js"></script>

        <script type="text/javascript" src="script/text/fr_buttons.js"></script>
        <script>

//////////////////////////////////////////////////////////////////////////////////////////////////

            function start() {

//Create a new Phaser JS game
                var game = new Phaser.Game("100%", "100%", Phaser.CANVAS, 'pgrou', {
//var game = new Phaser.Game(window.innerWidth * window.devicePixelRatio, window.innerHeight * window.devicePixelRatio, Phaser.CANVAS, 'pgrou', { 
//var game = new Phaser.Game(2000, 1000, Phaser.CANVAS, 'pgrou', { 
                    preload: preload,
                    create: create,
                    update: update,
                    render: render
                });
// Language Definition
                var language = "assets/audio/fr/";
                
           
//Load the necessary files before the beginning of the game
                function preload() {

                    game.load.spritesheet('hexagon', 'assets/sprites/hexagon.png', 130, 130);
                    game.load.spritesheet('square', 'assets/sprites/square.png', 130, 130);
                    game.load.spritesheet('diamond', 'assets/sprites/lozenge.png', 130, 130);
                    game.load.spritesheet('trapeze', 'assets/sprites/trapezoid.png', 130, 130);
                    game.load.spritesheet('triangle_equi', 'assets/sprites/triangle-equi.png', 130, 130);
                    game.load.spritesheet('triangle_rect', 'assets/sprites/triangle-rect.png', 130, 130);


                    game.load.image('store', 'assets/images/menu/store.png');
                    game.load.image('pipe', 'assets/images/menu/store-pipe.png');

                    game.load.spritesheet('trashbin', 'assets/images/buttons/trashbin.png', 83, 76);

                    game.load.spritesheet('button-square', 'assets/images/buttons/shape-square.png', 78, 77);
                    game.load.spritesheet('button-trapeze', 'assets/images/buttons/shape-trapeze.png', 78, 77);
                    game.load.spritesheet('button-triangle-equi', 'assets/images/buttons/shape-t-equi.png', 78, 77);
                    game.load.spritesheet('button-hexagon', 'assets/images/buttons/shape-hexagon.png', 78, 77);
                    game.load.spritesheet('button-triangle-rect', 'assets/images/buttons/shape-t-rect.png', 78, 77);
                    game.load.spritesheet('button-diamond', 'assets/images/buttons/shape-diamond.png', 78, 77);

                    game.load.image('basket-left', 'assets/images/menu/basket-left.png');
                    game.load.image('basket-right', 'assets/images/menu/basket-right.png');
                    game.load.image('basket-middle', 'assets/images/menu/basket-middle.png');

                    game.load.spritesheet('button-rotate-left', 'assets/images/buttons/option-rotateL.png', 48, 48);
                    game.load.spritesheet('button-rotate-right', 'assets/images/buttons/option-rotateR.png', 48, 48);
                    game.load.spritesheet('button-colors', 'assets/images/buttons/option-colors.png', 48, 48);
                    game.load.spritesheet('button-back', 'assets/images/buttons/option-map.png', 48, 48);
                    game.load.spritesheet('button-home', 'assets/images/buttons/option-home.png', 48, 48);
                    game.load.spritesheet('button-export', 'assets/images/buttons/option-export.png', 48, 48);
                    game.load.spritesheet('button-print', 'assets/images/buttons/option-print.png', 48, 48);
                    game.load.spritesheet('button-mute', 'assets/images/buttons/option-mute.png', 48, 48);
                    game.load.spritesheet('ribbon', 'assets/images/buttons/ribbon.png', 204, 391);

                    game.load.image('menu-left', 'assets/images/menu/menu-left.png');
                    game.load.image('menu-right', 'assets/images/menu/menu-right.png');
                    game.load.image('menu-middle', 'assets/images/menu/menu-middle.png');

                    game.load.image('patrick', 'assets/images/patrick/patrick.png');
                    game.load.spritesheet('patrick-mouth', 'assets/images/patrick/mouth.png', 31, 22, 4);
                    game.load.spritesheet('patrick-eyes', 'assets/images/patrick/eyes.png', 80, 66, 5);


                }

/////////////////////////////////////////SOUNDS/////////////////////////////////////////////////////////////////
// Sound click functions
function trashBinSound() {
    // la variable bin était deja utilisée pour autre chose ! (nom du bouton)
    // attention quand tu utlises des variables locales à ne pas ecraser des variables globales
    bintemp = soundManager.createSound({id : "bin", url: language+"trashbin.mp3"});
	bintemp.play();
}

function sound_trash(){
	if (cpttrash==0){
	trash = soundManager.createSound({id : "trash", url:language+"trash.mp3" });
	soundManager.stopAll();
	trash.play();}
	cpttrash ++;
	}

function clickerBack(){
click = soundManager.createSound({id : "click", url: language+"click.mp3", 
onfinish: function(){ self.location.href='levelsmap.html'}});
click.play();
}

function clickerHome(){
click = soundManager.createSound({id : "click", url: language+"click.mp3", 
onfinish: function(){ self.location.href='index.html'}});
click.play();
}

function clicker(){
	var clicker = soundManager.createSound({id : "clicker", url: language+"click.mp3",onfinish: function(){sound_placement();}});
	clicker.play();
}
	
	// Add Shapes Sounds 
	
function sound_square(nbF1){
 	nb1 = soundManager.createSound({id : "square"+nbF1, url:language+"square"+nbF1+".mp3"});
	soundManager.stopAll();
    patrickSpeak(nb1); // must be before play() instruction
	nb1.play();
}

function sound_trapeze(nbF2){
 	nb2 = soundManager.createSound({id : "pentagon"+nbF2, url:language+"pentagon"+nbF2+".mp3"});
	soundManager.stopAll();
	patrickSpeak(nb2);
	nb2.play();
}

function sound_hexagon(nbF3){
 	nb3 = soundManager.createSound({id : "hexagon"+nbF3, url:language+"hexagon"+nbF3+".mp3"});
	soundManager.stopAll();
	patrickSpeak(nb3);
	nb3.play();
}

function sound_triangle(nbF4){
 	nb4 = soundManager.createSound({id : "triangle"+nbF4, url:language+"triangle"+nbF4+".mp3"});
	soundManager.stopAll();
	patrickSpeak(nb4);
	nb4.play();
}

function sound_trirec(nbF5){
 	nb5 = soundManager.createSound({id : "trirec"+nbF1, url:language+"trirec"+nbF5+".mp3"});
	soundManager.stopAll();
	patrickSpeak(nb5);
	nb5.play();
}

function sound_diamond(nbF6){
 	nb6 = soundManager.createSound({id : "diamond"+nbF6, url:language+"diamond"+nbF6+".mp3"});
	soundManager.stopAll();
	patrickSpeak(nb6);
	nb6.play();
}	
	
	// Remove Shapes sounds

function sound_square_off(nbF1){
 	n1 = soundManager.createSound({id : "square_off"+nbF1, url:language+"square_off"+nbF1+".mp3"});
	soundManager.stopAll();
	patrickSpeak(n1);
	n1.play();
}	


function sound_trapeze_off(nbF2){
 	n2 = soundManager.createSound({id : "pentagon_off"+nbF2, url:language+"pentagon_off"+nbF2+".mp3"});
	soundManager.stopAll();
	patrickSpeak(n2);
	n2.play();
}	


function sound_hexagon_off(nbF3){
 	n3 = soundManager.createSound({id : "hexagon_off"+nbF3, url:language+"hexagon_off"+nbF3+".mp3"});
	soundManager.stopAll();
	patrickSpeak(n3);
	n3.play();
}	


function sound_triangle_off(nbF4){
 	n4 = soundManager.createSound({id : "triangle_off"+nbF4, url:language+"triangle_off"+nbF5+".mp3"});
	soundManager.stopAll();
	patrickSpeak(n4);
	n4.play();
}	


function sound_trirec_off(nbF6){
 	n5 = soundManager.createSound({id : "trirec_off"+nbF5, url:language+"trirec_off"+nbF5+".mp3"});
	soundManager.stopAll();
	patrickSpeak(n5);
	n5.play();
}	

function sound_diamond_off(nbF6){
 	n6 = soundManager.createSound({id : "diamond_off"+nbF6, url:language+"diamond_off"+nbF6+".mp3"});
	soundManager.stopAll();
	patrickSpeak(n6);
	n6.play();
}

function sound_rotation(){
	if (cptrot==0){
	rot = soundManager.createSound({id : "rot", url:language+"rot.mp3" });
	soundManager.stopAll();
	rot.play();}
	cptrot ++;
	}
	

function unlock_store(){
	if (cptlock==0){
	lock = soundManager.createSound({id : "lock", url:language+"lock.mp3" });
	soundManager.stopAll();
	patrickSpeak(lock);
	lock.play();}
	cptlock ++;
	}	

function  sound_begin(){
if (begin==0){
	begin = soundManager.createSound({id : "begin", url:language+"begin.mp3" });
	soundManager.stopAll();
	patrickSpeak(begin);
	begin.play();}
	begin ++;
	}		
	
function  sound_export(){
if (expo==0){
	exprt = soundManager.createSound({id : "exprt", url:language+"export.mp3" });
	soundManager.stopAll();
	//patrickSpeak(begin);
	exprt.play();}
	expo ++;
	}	
	
function  sound_color(){

	color = soundManager.createSound({id : "color", url:language+"color.mp3" });
	soundManager.stopAll();
	//patrickSpeak(begin);
	color.play();

	}		
	
function  sound_creation(){
if (crea==0){
	creation = soundManager.createSound({id : "creation", url:language+"creation.mp3", onfinish: function(){sound_color();}});
	soundManager.stopAll();
	//patrickSpeak(begin);
	creation.play();}
	crea ++;
	}			


function  sound_print(){
if (printer==0){
	printable = soundManager.createSound({id : "printable", url:language+"print.mp3" });
	soundManager.stopAll();
	//patrickSpeak(begin);
	printable.play();}
	printer ++;
	}
	

function  sound_placement(){
if (totalshape==1){
	alert("ca marche");
	placement = soundManager.createSound({id : "placement", url:language+"place.mp3" });
	soundManager.stopAll();
	//patrickSpeak(begin);
	placement.play();}
	
	}	
	
function  sound_sucess(){
	success= soundManager.createSound({id : "success", url:language+"success.mp3" });
	soundManager.stopAll();
	success.play();
	}		


function mute(){
if (!soundManager.muted){
soundManager.mute();}
else
soundManager.unmute();
}	

//////////////////////////////ANIMATIONS//////////////////////////////////////////////////////

function patrickSpeak(sound){
    sound.options.onplay = function(){
        patMouth.animations.play('talk',8,true);
    } 
    
    sound.options.onfinish = function(){
        patMouth.animations.stop(null,true);
    }
}

function patrickBlink(){
    patEyes.animations.play('blink',10,false);
    var delay = Math.random()*3 +2;
    game.time.events.add(Phaser.Timer.SECOND * delay, patrickBlink, this);
}


                //Main function of the game
                function create() {

                    //Build the wallpaper and RESIZE
                    wallpaper();

                    //Heritage Relationships
                    F1 = game.add.group();
                    F2 = game.add.group();
                    F3 = game.add.group();
                    F4 = game.add.group();
                    F5 = game.add.group();
                    F6 = game.add.group();

                    P1 = game.add.group();
                    P2 = game.add.group();
                    P3 = game.add.group();
                    P4 = game.add.group();
                    P5 = game.add.group();
                    P6 = game.add.group();

                    forms = game.add.group();
                    patterns = game.add.group();


                    forms.add(F1);
                    forms.add(F2);
                    forms.add(F3);
                    forms.add(F4);
                    forms.add(F5);
                    forms.add(F6);

                    patterns.add(P1);
                    patterns.add(P2);
                    patterns.add(P3);
                    patterns.add(P4);
                    patterns.add(P5);
                    patterns.add(P6);


                    //Build the menu
                    buildMenu();

                    //Create the wished pattern
                    var patterns2 = [];
                    //Get the JSON content
                    var result = document.getElementById('cache').innerText;
                    document.getElementById('json').style.display = 'none';
                    document.getElementById('menu').style.display = 'none';
                    //JSON analysis				
                    var jsonObj = JSON.parse(result);
                    //Pattern creation

                    for (var i = 0; i < jsonObj.problem.pattern.length; i++) {

                        switch (jsonObj.problem.pattern[i].shape) {
                            case "square":
                                patterns2[i] = P1.create(Number(jsonObj.problem.pattern[i].anchorPoint.x), Number(jsonObj.problem.pattern[i].anchorPoint.y), 'square');
                                patterns2[i].inputEnabled = true;
                                patterns2[i].tint = 0x020303;
                                patterns2[i].frame = Number(jsonObj.problem.pattern[i].rotation);
                                patterns2[i].alpha = 0.4;
                                patterns2[i].wantedColor = jsonObj.problem.pattern[i].color;
                                break;
                            case "trapeze":
                                patterns2[i] = P2.create(Number(jsonObj.problem.pattern[i].anchorPoint.x), Number(jsonObj.problem.pattern[i].anchorPoint.y), 'trapeze');
                                patterns2[i].inputEnabled = true;
                                patterns2[i].tint = 0x020303;
                                patterns2[i].frame = Number(jsonObj.problem.pattern[i].rotation);
                                patterns2[i].alpha = 0.4;
                                patterns2[i].wantedColor = jsonObj.problem.pattern[i].color;
                                break;
                            case "hexagon":
                                patterns2[i] = P3.create(Number(jsonObj.problem.pattern[i].anchorPoint.x), Number(jsonObj.problem.pattern[i].anchorPoint.y), 'hexagon');
                                patterns2[i].inputEnabled = true;
                                patterns2[i].tint = 0x020303;
                                patterns2[i].frame = Number(jsonObj.problem.pattern[i].rotation);
                                patterns2[i].alpha = 0.4;
                                patterns2[i].wantedColor = jsonObj.problem.pattern[i].color;
                                break;
                            case "triangleEqui":
                                patterns2[i] = P4.create(Number(jsonObj.problem.pattern[i].anchorPoint.x), Number(jsonObj.problem.pattern[i].anchorPoint.y), 'triangle_equi');
                                patterns2[i].inputEnabled = true;
                                patterns2[i].tint = 0x020303;
                                patterns2[i].frame = Number(jsonObj.problem.pattern[i].rotation);
                                patterns2[i].alpha = 0.4;
                                patterns2[i].wantedColor = jsonObj.problem.pattern[i].color;
                                break;
                            case "triangleRect":
                                patterns2[i] = P5.create(Number(jsonObj.problem.pattern[i].anchorPoint.x), Number(jsonObj.problem.pattern[i].anchorPoint.y), 'triangle_rect');
                                patterns2[i].inputEnabled = true;
                                patterns2[i].tint = 0x020303;
                                patterns2[i].frame = Number(jsonObj.problem.pattern[i].rotation);
                                patterns2[i].alpha = 0.4;
                                patterns2[i].wantedColor = jsonObj.problem.pattern[i].color;
                                break;
                            case "diamond":
                                patterns2[i] = P6.create(Number(jsonObj.problem.pattern[i].anchorPoint.x), Number(jsonObj.problem.pattern[i].anchorPoint.y), 'diamond');
                                patterns2[i].inputEnabled = true;
                                patterns2[i].tint = 0x020303;
                                patterns2[i].frame = Number(jsonObj.problem.pattern[i].rotation);
                                patterns2[i].alpha = 0.4;
                                patterns2[i].wantedColor = jsonObj.problem.pattern[i].color;
                                break;
                        }
                    }

                    //Distributors
                    if (jsonObj.distrib == "off") {

                        distrib = 0;

                        //We add the form into the Basket
                        P1.forEach(function (pattern) {
                            addShape('square', F1);
                        });

                        P2.forEach(function (pattern) {
                            addShape('trapeze', F2);
                        });
                        P3.forEach(function (pattern) {
                            addShape('hexagon', F3);
                        });
                        P4.forEach(function (pattern) {
                            addShape('triangle_equi', F4);
                        });
                        P5.forEach(function (pattern) {
                            addShape('triangle_rect', F5);
                        });
                        P6.forEach(function (pattern) {
                            addShape('diamond', F6);
                        });

                        //we hide the distributors 
                        buttonSquare.visible = false;
                        labelSquare.visible = false;

                        buttonHexagon.visible = false;
                        labelHexagon.visible = false;

                        buttonTrapezoid.visible = false;
                        labelTrapezoid.visible = false;

                        buttonTriangleEqui.visible = false;
                        labelTriangleEqui.visible = false;

                        buttonTriangleRect.visible = false;
                        labelTriangleRect.visible = false;

                        buttonDiamond.visible = false;
                        labelDiamond.visible = false;

                        //we hide the bin
                        bin.visible = false;

                        //We lock the distributors

                        unlockButton = game.add.button(5, 5, 'ribbon', unlockStore, this, 1, 0, 1, 0);
                        storeLocked = true;
                        buttonSquare.inputEnabled = false;
                        buttonTrapezoid.inputEnabled = false;
                        buttonTriangleEqui.inputEnabled = false;
                        buttonHexagon.inputEnabled = false;
                        buttonTriangleRect.inputEnabled = false;
                        buttonDiamond.inputEnabled = false;

                    } else {

                        var cptSquare = 0;
                        P1.forEach(function (pattern) {
                            cptSquare++;
                        });
                        var cptTrapeze = 0;
                        P2.forEach(function (pattern) {
                            cptTrapeze++;
                        });
                        var cptHexagon = 0;
                        P3.forEach(function (pattern) {
                            cptHexagon++;
                        });
                        var cptTriangleEqui = 0;
                        P4.forEach(function (pattern) {
                            cptTriangleEqui++;
                        });
                        var cptTriangleRect = 0;
                        P5.forEach(function (pattern) {
                            cptTriangleRect++;
                        });
                        var cptDiamond = 0;
                        P6.forEach(function (pattern) {
                            cptDiamond++;
                        });


                        if (cptSquare == 0) {
                            buttonSquare.visible = false;
                            labelSquare.visible = false;
                        }
                        if (cptHexagon == 0) {
                            buttonHexagon.visible = false;
                            labelHexagon.visible = false;
                        }
                        if (cptTrapeze == 0) {
                            buttonTrapezoid.visible = false;
                            labelTrapezoid.visible = false;
                        }
                        if (cptTriangleEqui == 0) {
                            buttonTriangleEqui.visible = false;
                            labelTriangleEqui.visible = false;
                        }
                        if (cptTriangleRect == 0) {
                            buttonTriangleRect.visible = false;
                            labelTriangleRect.visible = false;
                        }
                        if (cptDiamond == 0) {
                            buttonDiamond.visible = false;
                            labelDiamond.visible = false;
                        }
                    }

                    //Update the pattern matrix with the shapes' matrix

                    P1.forEach(function (patternItem) {
                        areaPattern = areaPattern + shapes.square.area[patternItem.frame];
                        addShapeMatrix(patternItem, 1);
                    }, this);

                    P2.forEach(function (patternItem) {
                        areaPattern = areaPattern + shapes.trapeze.area[patternItem.frame];
                        addShapeMatrix(patternItem, 1);
                    }, this);

                    P3.forEach(function (patternItem) {
                        areaPattern = areaPattern + shapes.hexagon.area[patternItem.frame];
                        addShapeMatrix(patternItem, 1);
                    }, this);

                    P4.forEach(function (patternItem) {
                        areaPattern = areaPattern + shapes.triangleEqui.area[patternItem.frame];
                        addShapeMatrix(patternItem, 1);
                    }, this);

                    P5.forEach(function (patternItem) {
                        areaPattern = areaPattern + shapes.triangleRect.area[patternItem.frame];
                        addShapeMatrix(patternItem, 1);
                    }, this);

                    P6.forEach(function (patternItem) {
                        areaPattern = areaPattern + shapes.diamond.area[patternItem.frame];
                        addShapeMatrix(patternItem, 1);
                    }, this);
                }

//Update function that is always running on the background to resize
                function updateSize() {
// Adapt the size of the interface to the screen
                    pipe.height = window.innerHeight - (390 + 212);
                    // Basket position
                    basketLeft.y = window.innerHeight - (5 + basketLeft.height);
                    basketMiddle.x = basketLeft.x + basketLeft.width;
                    basketMiddle.y = window.innerHeight - (5 + basketLeft.height);
                    basketMiddle.width = window.innerWidth - (basketLeft.width + basketRight.width);
                    basketRight.x = window.innerWidth - (5 + basketRight.width);
                    basketRight.y = window.innerHeight - (5 + basketRight.height);

                    // Buttons on basket
                    rotL.y = window.innerHeight - 210;
                    rotR.y = window.innerHeight - 210;

                    // Menu position
                    menuLeft.x = window.innerWidth - (5 + menuLenght + menuLeft.width + menuRight.width);
                    menuRight.x = window.innerWidth - (5 + menuRight.width);
                    menuMiddle.x = window.innerWidth - (5 + menuLenght + menuRight.width);
                    menuMiddle.width = menuLenght;

                    // Buttons on menu
                    mute.x = window.innerWidth - (18 + 1 * 50);
                    home.x = window.innerWidth - (18 + 2 * 50);
                    ret.x = window.innerWidth - (18 + 3 * 50);

                    //Patrick position
                    pat.x = basketRight.x + 5;
                    pat.y = basketRight.y - 135;

                    //positions of shapes in the basket
                    forms.forEach(function (F) {
                        F.forEach(function (tempSprite) {
                            if ((tempSprite.y > 500) || (tempSprite.y < 25) || (tempSprite.x > 1000) || (tempSprite.x < 225)) {
                                tempSprite.y = window.innerHeight - 155;
                                if (tempSprite.x + tempSprite.width > window.innerWidth) {
                                    tempSprite.x = Math.random() * (window.innerWidth - 310) + 90;
                                }
                                tempSprite.originalPosition = tempSprite.position.clone();
                            }
                        }, this);
                    }, this);

                }

//Update function that is always running on the background
                function update() {
                    // Update of the shadows
                    /*shadows.removeAll();
                     forms.forEach(function (F) {
                     F.forEach(function (sprite) {
                     var aShadow = game.add.sprite(sprite.x + 3, sprite.y + 3, sprite.generateTexture());
                     shadows.add(aShadow);
                     aShadow.anchor.x = 0;
                     aShadow.anchor.y = 0;
                     aShadow.tint = 0x000000;
                     aShadow.alpha = 0.3;
                     });
                     });*/

                }

                function buildMenu() {

                    // Store Creation
                    var store = game.add.sprite(5, 5, 'store');
                    pipe = game.add.sprite(5, 395, 'pipe');
                    pipe.height = window.innerHeight - (390 + 212);

                    // Buttons in store
                    bin = game.add.button(55, 20, 'trashbin', null, this, 2, 1, 0, 1);
                    bin.events.onInputOver.add(sound_trash, this);

                    var style = {font: "25px Arial", fontWeight: "bold", fill: "#93AFBD"};
                    buttonSquare = game.add.button(15, 110, 'button-square', addForm1, this, 2, 1, 0, 1);
                    labelSquare = game.add.text(53, 130, nbF1, style);
                    labelSquare.anchor.x = 0.5;

                    buttonTrapezoid = game.add.button(105, 110, 'button-trapeze', addForm2, this, 2, 1, 0, 1);
                    labelTrapezoid = game.add.text(142, 130, nbF2, style);
                    labelTrapezoid.anchor.x = 0.5;

                    buttonTriangleEqui = game.add.button(15, 200, 'button-triangle-equi', addForm4, this, 2, 1, 0, 1);
                    labelTriangleEqui = game.add.text(53, 220, nbF4, style);
                    labelTriangleEqui.anchor.x = 0.5;

                    buttonHexagon = game.add.button(105, 200, 'button-hexagon', addForm3, this, 2, 1, 0, 1);
                    labelHexagon = game.add.text(142, 220, nbF3, style);
                    labelHexagon.anchor.x = 0.5;

                    buttonTriangleRect = game.add.button(15, 290, 'button-triangle-rect', addForm5, this, 2, 1, 0, 1);
                    labelTriangleRect = game.add.text(53, 310, nbF5, style);
                    labelTriangleRect.anchor.x = 0.5;

                    buttonDiamond = game.add.button(105, 290, 'button-diamond', addForm6, this, 2, 1, 0, 1);
                    labelDiamond = game.add.text(142, 310, nbF6, style);
                    labelDiamond.anchor.x = 0.5;

                    // Basket creation
                    basketLeft = game.add.sprite(5, 0, 'basket-left');
                    basketMiddle = game.add.sprite(0, 0, 'basket-middle');
                    basketRight = game.add.sprite(0, 0, 'basket-right');

                    basketLeft.y = window.innerHeight - (5 + basketLeft.height);
                    basketMiddle.x = basketLeft.x + basketLeft.width;
                    basketMiddle.y = window.innerHeight - (5 + basketLeft.height);
                    basketMiddle.width = window.innerWidth - (basketLeft.width + basketRight.width);
                    basketRight.x = window.innerWidth - (5 + basketRight.width);
                    basketRight.y = window.innerHeight - (5 + basketRight.height);

                    // Menu construction
                    switch (mode) {
                        case "levelMode":
                            menuLenght = 225;
                            break;
                        case "freeMode":
                            menuLenght = 150;
                            break;
                    }

                    menuRight = game.add.sprite(0, 5, 'menu-right');
                    menuLeft = game.add.sprite(0, 5, 'menu-left');
                    menuMiddle = game.add.sprite(0, 5, 'menu-middle');

                    menuLeft.x = window.innerWidth - (5 + menuLenght + menuLeft.width + menuRight.width);
                    menuRight.x = window.innerWidth - (5 + menuRight.width);
                    menuMiddle.x = window.innerWidth - (5 + menuLenght + menuRight.width);
                    menuMiddle.width = menuLenght;

                    //Add rotation and color buttons
                    rotR = game.add.button(75, window.innerHeight - 210, 'button-rotate-right', rotationRightButton, this, 2, 1, 0, 1);
                    rotR.events.onInputOver.add(sound_rotation, this);
                    rotL = game.add.button(15, window.innerHeight - 210, 'button-rotate-left', rotationLeftButton, this, 2, 1, 0, 1);
                    rotL.events.onInputOver.add(sound_rotation, this);
                    home = game.add.button(window.innerWidth - (18 + 4 * 50), 10, 'button-home', clickerHome, this, 2, 1, 0, 1);
                    mute = game.add.button(window.innerWidth - (18 + 1 * 50), 10, 'button-mute', mute, this, 2, 1, 0, 1);


                    // Add Patrick to the menu
                    pat = game.add.group();
                    // position
                    pat.x = basketRight.x + 5;
                    pat.y = basketRight.y - 135;
                    pat.scale.set(0.27, 0.27);
                    // independant elements
                    var patBody = game.add.sprite(0, 0, 'patrick');
                    pat.add(patBody);
                    patMouth = game.add.sprite(217, 168, 'patrick-mouth');
                    pat.add(patMouth);
                    patEyes = game.add.sprite(196, 80, 'patrick-eyes');
                    pat.add(patEyes);
                    //animations
                    patMouth.animations.add('talk');
                    patEyes.animations.add('blink');

                    patrickBlink();

                    shadows = game.add.group();


                            ret = game.add.button(window.innerWidth - (18 + 3 * 50), 10, 'button-back', clickerBack, this, 2, 1, 0, 1);
                            home.x = window.innerWidth - (18 + 2 * 50);
                            var levelStyle = {font: "23px Arial", fontWeight: "bold", fill: "#0D004C"};
                            levelName = game.add.text(window.innerWidth - 280, 23,"", levelStyle);
                            sound_begin();

                }

                //Function to add shapes from the basket
                //Function to add shapes from the basket
                function addShape(shape, F) {
                    nbF = nbF + 1;
                    var position = Math.random() * (game.width - 310) + 90;
                    var tempSprite = F.create(position, game.height - 155, shape);
                    tempSprite.anchor.x = 0;
                    tempSprite.anchor.y = 0;
                    tempSprite.originalPosition = tempSprite.position.clone();
                    game.world.bringToTop(forms);

                    //tempSprite.tint = Math.random() * 0xffffff;
                    //tempSprite.tint= palette[Math.floor(Math.random() * palette.length)];
                    tempSprite.tint = 0x93AFBD;

                    tempSprite.inputEnabled = true; //Active Input
                    tempSprite.input.enableDrag(false, true); //Mobile (drag)
                    tempSprite.input.enableSnap(1, 1, false, true); //Grid of 1 pixel
                    tempSprite.events.onInputDown.add(formInteraction, this); //Edition mode after click
                    if (mode == "levelMode") {
                        tempSprite.events.onDragStart.add(beginDrag, this);
                    }
                    tempSprite.events.onDragStop.add(endDrag, this); //End of drag

                    tempSprite.events.onInputOver.add(function () {
                        switch (test) {
                            case 1:
                                this.game.canvas.style.cursor = "url('assets/images/cursors/rotR.png'),default";
                                break;
                            case 2:
                                this.game.canvas.style.cursor = "url('assets/images/cursors/rotL.png'),default";
                                break;
                            case 3:
                                this.game.canvas.style.cursor = "url('assets/images/cursors/col.png'),default";
                                break;
                            default:
                                this.game.canvas.style.cusor = "default";
                        }
                    });
                    totalshape++;

                }

                function addForm1(form1, pointer) {
                    nbF1 = nbF1 + 1;
                    labelSquare.text = nbF1;
                    addShape('square', F1);
                    sound_square(nbF1);
                }

                function addForm2(form2, pointer) {
                    nbF2 = nbF2 + 1;
                    labelTrapezoid.text = nbF2;
                    addShape('trapeze', F2);
                    sound_trapeze(nbF2);
                }

                function addForm3(form3, pointer) {
                    nbF3 = nbF3 + 1;
                    labelHexagon.text = nbF3;
                    addShape('hexagon', F3);
                    sound_hexagon(nbF3);
                }

                function addForm4(form4, pointer) {
                    nbF4 = nbF4 + 1;
                    labelTriangleEqui.text = nbF4;
                    addShape('triangle_equi', F4);
                    sound_triangle(nbF4)
                }

                function addForm5(form5, pointer) {
                    nbF5 = nbF5 + 1;
                    labelTriangleRect.text = nbF5;
                    addShape('triangle_rect', F5);
                    sound_trirec(nbF5);
                }

                function addForm6(form6, pointer) {
                    nbF6 = nbF6 + 1;
                    labelDiamond.text = nbF6;
                    addShape('diamond', F6);
                    sound_diamond(nbF6);
                }

//Edition Modes (colors and rotation)

                function formInteraction(tempSprite, pointer) {
                    switch (test) {
                        case 0:
                            break;
                        case 1:
                            tempSprite.frame++;
                            affichage = tempSprite.frame;
                            tempSprite.updateCache();
                            break;
                        case 2:
                            if (tempSprite.frame == 0) {
                                tempSprite.animations.add('test');
                                tempSprite.frame = tempSprite.animations.frameTotal - 1;
                            } else {
                                tempSprite.frame--;
                            }
                            tempSprite.updateCache();
                            break;
                        case 3:
                            var rand = Math.floor((Math.random() * 5));
                            tempSprite.tint = palette[Math.floor(Math.random() * palette.length)];
                            break;
                    }
                }

//Activation of the rotation button
                function rotationRightButton(rot, pointer) {
                    switch (test) {
                        case 0:
                            test = 1;
                            rotR.setFrames(3, 0, 1, 0);
                            break;
                        case 1:
                            test = 0;
                            rotR.setFrames(2, 1, 0, 1);
                            break;
                        case 2:
                            test = 1;
                            rotR.setFrames(3, 0, 1, 0);
                            rotL.setFrames(2, 1, 0, 1);
                            break;
                        case 3:
                            test = 1;
                            rotR.setFrames(3, 0, 1, 0);
                            col.setFrames(2, 1, 0, 1);
                            break;
                    }
                    clicker();
                }

                function rotationLeftButton(rot, pointer) {
                    switch (test) {
                        case 0:
                            test = 2;
                            rotL.setFrames(3, 0, 1, 0);
                            break;
                        case 1:
                            test = 2;
                            rotL.setFrames(3, 0, 1, 0);
                            rotR.setFrames(2, 1, 0, 1);
                            break;
                        case 2:
                            test = 0;
                            rotL.setFrames(2, 1, 0, 1);
                            break;
                        case 3:
                            test = 2;
                            rotL.setFrames(3, 0, 1, 0);
                            col.setFrames(2, 1, 0, 1);
                            break;
                    }
                    clicker();
                }


// Change color
                function colorButton(col, pointer) {
                    switch (test) {
                        case 0:
                            test = 3;
                            col.setFrames(3, 0, 1, 0);
                            break;
                        case 1:
                            test = 3;
                            rotR.setFrames(2, 1, 0, 1);
                            col.setFrames(3, 0, 1, 0);
                            break;
                        case 2:
                            test = 3;
                            rotL.setFrames(2, 1, 0, 1);
                            col.setFrames(3, 0, 1, 0);
                            break;
                        case 3:
                            test = 0;
                            col.setFrames(2, 1, 0, 1);
                            break;
                    }
                    clicker();
                }

                function deleteSprite(tempSprite) {
                    if (tempSprite.key == 'square') {
                        nbF1 = nbF1 - 1;
                        labelSquare.text = nbF1;
                    }
                    if (tempSprite.key == 'trapeze') {
                        nbF2 = nbF2 - 1;
                        labelTrapezoid.text = nbF2;
                    }
                    if (tempSprite.key == 'hexagon') {
                        nbF3 = nbF3 - 1;
                        labelHexagon.text = nbF3;
                    }
                    if (tempSprite.key == 'triangle_equi') {
                        nbF4 = nbF4 - 1;
                        labelTriangleEqui.text = nbF4;
                    }
                    if (tempSprite.key == 'triangle_rect') {
                        nbF5 = nbF5 - 1;
                        labelTriangleRect.text = nbF5;
                    }
                    if (tempSprite.key == 'diamond') {
                        nbF6 = nbF6 - 1;
                        labelDiamond.text = nbF6;
                    }
                    tempSprite.destroy();
                    trashBinSound();
                }


                function wallpaper() {
                    game.scale.scaleMode = Phaser.ScaleManager.RESIZE;
                    game.scale.setResizeCallback(function () {
                        updateSize(this);
                    }, game);
//Wallpaper
                    var myBitmap = game.make.bitmapData(2000, 2000);
                    myBitmap.addToWorld();
                    var grd = myBitmap.context.createLinearGradient(0, 0, 1000, 1000);
                    grd.addColorStop(0, "#66d1f9");
                    grd.addColorStop(1, "#bce3f0");
                    myBitmap.context.fillStyle = grd;
                    myBitmap.context.fillRect(0, 0, 2000, 2000);
//game.stage.backgroundColor = "#4488AA";
                    palette = ["0x83EE00", "0xFBFE00", "0x058AB6", "0xE4005C", "0x8007BE", "0xFF8300"];

                    shadows = game.add.group();
                }

// Lock the store if we start to drag a shape
                function beginDrag(tempSprite) {
                    if (!storeLocked) {
                        unlockButton = game.add.button(5, 5, 'ribbon', unlockStore, this, 1, 0, 1, 0);
                        unlockButton.events.onInputOver.add(unlock_store, this);
                        storeLocked = true;
                        buttonSquare.inputEnabled = false;
                        buttonTrapezoid.inputEnabled = false;
                        buttonTriangleEqui.inputEnabled = false;
                        buttonHexagon.inputEnabled = false;
                        buttonTriangleRect.inputEnabled = false;
                        buttonDiamond.inputEnabled = false;
                    }
                }

// Unlock the store once the unlockButton is clicked
                function unlockStore(lockButton, pointer) {
                    if (distrib == 1) {
                        lockButton.destroy();
                        storeLocked = false;
                        buttonSquare.inputEnabled = true;
                        buttonTrapezoid.inputEnabled = true;
                        buttonTriangleEqui.inputEnabled = true;
                        buttonHexagon.inputEnabled = true;
                        buttonTriangleRect.inputEnabled = true;
                        buttonDiamond.inputEnabled = true;
                    }
                }




                var affichage = "";


// to differentiate between a simple click and a real drag
                function isDrag() {
                    var distanceFromLastUp = distance(game.input.activePointer.positionDown.x, game.input.activePointer.positionDown.y, game.input.activePointer.x, game.input.activePointer.y);
                    if (distanceFromLastUp > 2) { // value 2 determined empiracally
                        return true;
                    } else {
                        return false;
                    }
                }

                function snapEffect(tempSprite, gameMode) {

                    for (var i = 0; i < 1300; i++) {
                        for (var j = 0; j < 1300; j++) {
                            matSnap[i][j] = 0;
                        }
                    }

                    if (gameMode == 'levelMode') {
                        // add the shapes from the pattern into the snap matrix, to get the global contours to which we want to snap
                        P1.forEach(function (patternItem) {
                            addShapeMatrix(patternItem, 3);
                        }, this);

                        P2.forEach(function (patternItem) {
                            addShapeMatrix(patternItem, 3);
                        }, this);

                        P3.forEach(function (patternItem) {
                            addShapeMatrix(patternItem, 3);
                        }, this);

                        P4.forEach(function (patternItem) {
                            addShapeMatrix(patternItem, 3);
                        }, this);

                        P5.forEach(function (patternItem) {
                            addShapeMatrix(patternItem, 3);
                        }, this);

                        P6.forEach(function (patternItem) {
                            addShapeMatrix(patternItem, 3);
                        }, this);
                    }
                    // add the shapes already in the game (except the shape that has just been dragged)
                    // in order to update the contours to which we want to snap
                    F1.forEach(function (patternItem) {
                        if (patternItem.key != tempSprite.key && patternItem.x != tempSprite.x && patternItem.y != tempSprite.y) {
                            addShapeMatrix(patternItem, 3);
                        }
                    }, this);

                    F2.forEach(function (patternItem) {
                        if (patternItem.key != tempSprite.key && patternItem.x != tempSprite.x && patternItem.y != tempSprite.y) {
                            addShapeMatrix(patternItem, 3);
                        }
                    }, this);

                    F3.forEach(function (patternItem) {
                        if (patternItem.key != tempSprite.key && patternItem.x != tempSprite.x && patternItem.y != tempSprite.y) {
                            addShapeMatrix(patternItem, 3);
                        }
                    }, this);

                    F4.forEach(function (patternItem) {
                        if (patternItem.key != tempSprite.key && patternItem.x != tempSprite.x && patternItem.y != tempSprite.y) {
                            addShapeMatrix(patternItem, 3);
                        }
                    }, this);

                    F5.forEach(function (patternItem) {
                        if (patternItem.key != tempSprite.key && patternItem.x != tempSprite.x && patternItem.y != tempSprite.y) {
                            addShapeMatrix(patternItem, 3);
                        }
                    }, this);

                    F6.forEach(function (patternItem) {
                        if (patternItem.key != tempSprite.key && patternItem.x != tempSprite.x && patternItem.y != tempSprite.y) {
                            addShapeMatrix(patternItem, 3);
                        }
                    }, this);


                    // calculate the best position for tempSprite (snap effect)

                    var criteria = 0;
                    var criteriaTemp = 0;
                    var range_i = 30; // must be an even number
                    var range_j = 30; // must be an even number
                    var i_init = tempSprite.y;
                    var j_init = tempSprite.x;
                    var i_opt = tempSprite.y; // to store the best position we have found for tempSprite
                    var j_opt = tempSprite.x;
                    var i_temp;
                    var j_temp;

                    for (var i = 0; i < range_i; i++) {
                        for (var j = 0; j < range_j; j++) {
                            i_temp = i_init + (i - range_i / 2);
                            j_temp = j_init + (j - range_j / 2);
                            criteriaTemp = calculateCommonContours(tempSprite, i_temp, j_temp);
                            if ((i == 0) && (j == 0)) { // 1st iteration
                                criteria = criteriaTemp;
                            }
                            if (criteriaTemp > criteria) {
                                criteria = criteriaTemp;
                                i_opt = i_temp;
                                j_opt = j_temp;
                            } else {
                                if (criteriaTemp == criteria) {
                                    if (distance(i_init, j_init, i_temp, j_temp) < distance(i_init, j_init, i_opt, j_opt)) {
                                        i_opt = i_temp;
                                        j_opt = j_temp;
                                    }
                                }
                            }
                        }
                    }
                    tempSprite.x = j_opt;
                    tempSprite.y = i_opt;
                }

                function distance(i1, j1, i2, j2) {
                    return Math.sqrt((i1 - i2) * (i1 - i2) + (j1 - j2) * (j1 - j2))
                }

                function calculateCommonContours(tempSprite, i, j) {

                    var matShape = [];
                    if (tempSprite.key == 'square') {
                        matShape = shapes.square.mat[tempSprite.frame];
                    }
                    if (tempSprite.key == 'trapeze') {
                        matShape = shapes.trapeze.mat[tempSprite.frame];
                    }
                    if (tempSprite.key == 'hexagon') {
                        matShape = shapes.hexagon.mat[tempSprite.frame];
                    }
                    if (tempSprite.key == 'triangle_equi') {
                        matShape = shapes.triangleEqui.mat[tempSprite.frame];
                    }
                    if (tempSprite.key === 'triangle_rect') {
                        matShape = shapes.triangleRect.mat[tempSprite.frame];
                    }
                    if (tempSprite.key === 'diamond') {
                        matShape = shapes.diamond.mat[tempSprite.frame];
                    }

                    var res = 0;
                    for (var ii = 0; ii < nbPixels; ii++) {
                        for (var jj = 0; jj < nbPixels; jj++) {
                            if (matShape[ii][jj] == 2 && matSnap[i + ii][j + jj] == 2) {
                                res++;
                            }
                        }
                    }
                    return res;
                }

                function colorSprite(tempSprite, gameMode) { // gameMode = 'levelMode' or 'freeMode'
                    if (gameMode == 'levelMode') {
                        var isColored = 0;
                        switch (tempSprite.key) {
                            case 'square':
                                var M = shapes.square.mat[tempSprite.frame];
                                break;
                            case 'trapeze':
                                var M = shapes.trapeze.mat[tempSprite.frame];
                                break;
                            case 'hexagon':
                                var M = shapes.hexagon.mat[tempSprite.frame];
                                break;
                            case 'triangle_equi':
                                var M = shapes.triangleEqui.mat[tempSprite.frame];
                                break;
                            case 'triangle_rect':
                                var M = shapes.triangleRect.mat[tempSprite.frame];
                                break;
                            case 'diamond':
                                var M = shapes.diamond.mat[tempSprite.frame];
                                break;

                        }
                        var isIN = 1;
                        for (var i = 0; i < nbPixels; i++) {
                            for (var j = 0; j < nbPixels; j++) {
                                if (M[i][j] == 1) {
                                    if (matPattern[tempSprite.y + i][tempSprite.x + j] != 1 && matPattern[tempSprite.y + i][tempSprite.x + j] != 2) {
                                        isIN = 0;
                                    }
                                }
                            }
                        }

                        if (isIN == 1) {
                            patterns.forEach(function (P) {
                                P.forEach(function (pattern) {
                                    if (tempSprite.key == pattern.key && pattern.x == tempSprite.x && pattern.y == tempSprite.y && pattern.frame == tempSprite.frame) {
                                        tempSprite.tint = pattern.wantedColor;
                                        isColored = 1;
                                    }
                                }, this);
                            }, this);
                            if (isColored == 0) {
                                tempSprite.tint = palette[Math.floor(Math.random() * palette.length)];
                                isColored = 1;
                            }
                        } else {
                            tempSprite.tint = 0x93AFBD;
                            isColored = 1;
                        }
                    }
                }



                function updateSolution() {
                    for (var i = 0; i < 1300; i++) {
                        for (var j = 0; j < 1300; j++) {
                            matSolution[i][j] = 0;
                        }
                    }
                    // update matSolution
                    areaSolution = 0;

                    F1.forEach(function (patternItem) {
                        areaSolution = areaSolution + shapes.square.area[patternItem.frame];
                        addShapeMatrix(patternItem, 2);
                    }, this);

                    F2.forEach(function (patternItem) {
                        areaSolution = areaSolution + shapes.trapeze.area[patternItem.frame];
                        addShapeMatrix(patternItem, 2);
                    }, this);

                    F3.forEach(function (patternItem) {
                        areaSolution = areaSolution + shapes.hexagon.area[patternItem.frame];
                        addShapeMatrix(patternItem, 2);
                    }, this);

                    F4.forEach(function (patternItem) {
                        areaSolution = areaSolution + shapes.triangleEqui.area[patternItem.frame];
                        addShapeMatrix(patternItem, 2);
                    }, this);

                    F5.forEach(function (patternItem) {
                        areaSolution = areaSolution + shapes.triangleRect.area[patternItem.frame];
                        addShapeMatrix(patternItem, 2);
                    }, this);

                    F6.forEach(function (patternItem) {
                        areaSolution = areaSolution + shapes.diamond.area[patternItem.frame];
                        addShapeMatrix(patternItem, 2);
                    }, this);


                    // Vérification de la solution    
                    valid = 0;

                    for (var i = 0; i < 1300; i++) {
                        for (var j = 0; j < 1300; j++) {
                            if (matSolution[i][j] != matPattern[i][j]) {
                                valid++;
                            }
                        }
                    }

                    if (valid < 1500 && areaSolution == areaPattern) {
                        fin = 1;
                        var delay = 500;
                        setTimeout(function () {
                            //alert("Bravo! Vous avez réussi ce niveau!");
                            document.getElementById("final").style.display = "block";
                            pat.visible = false;
                            sound_sucess();
                        }, delay);
                    }
                }



//Function at the end of the drag
                var distrib = 1;
                function endDrag(tempSprite, pointer) {
                    game.world.bringToTop(forms);

                    if ((game.input.y > bin.y) && (game.input.y < bin.y + bin.height) && (game.input.x > bin.x) && (game.input.x < bin.x + bin.width)) {
                        if (distrib == 1) {
                            deleteSprite(tempSprite);
                        }
                    } else {
                        if ((tempSprite.y > 500) || (tempSprite.y < 25) || (tempSprite.x > 1000) || (tempSprite.x < 225)) {
                            tempSprite.position.copyFrom(tempSprite.originalPosition);
                        }
                        else {
                            snapEffect(tempSprite, 'levelMode');
                            tempSprite.originalPosition = tempSprite.position.clone();
                            colorSprite(tempSprite, 'levelMode');
                        }
                    }
                    updateSolution();
                }



//Debugging Mode       
                function render() {
                    game.debug.style = '#fff';
                    //game.debug.text('Squares : ' + nbF1, 16, 48);
                    //game.debug.text('Trapezes : ' + nbF2, 16, 60);
                    //game.debug.text('Hexagons : ' + nbF3, 16, 72);
                    //game.debug.text('Triangles : ' + nbF4, 16, 84);
                    //game.debug.text('Rect Triangles : ' + nbF5, 16, 96);
                    //game.debug.text('Diamonds : ' + nbF6, 16, 108);
                    //game.debug.text('Function : ' + test, 16, 120);
                    //game.debug.text('Valid : ' + valid, 16, 108);
                    //game.debug.text('Solution Area: ' + areaSolution, 16, 120);
                    //game.debug.text('Problem Area: ' + areaPattern, 16, 132);
                    //game.debug.text('matProblem : ' + matPattern[350][350], 16, 144);
                    //game.debug.text('MatSolution : ' + matSolution[350][350], 16, 156);
                    game.debug.text('Input X : ' + game.input.x, 16, 168);
                    game.debug.text('Input Y : ' + game.input.y, 16, 180);
                    //game.debug.inputInfo(16, 144);
                }

            }
/////////////////////////////////////////////////////////////

            //Function to verify the extension 
            function checkExtension() {
                var fileInput = document.getElementById('fileInput');
                var myString = fileInput.value;
                var myExt = myString.substring(myString.lastIndexOf(".") + 1, myString.length);
                myExt = myExt.toLowerCase();
                //Error message if it is not a JSON
                if (myExt !== "json") {
                    alert(errorLoad);
                } else {
                    //If it is good, we launch the game
                    document.body.style.backgroundImage = "none";
                    start();
                }
            }


            //Load JSON file
            window.onload = function () {
                var fileInput = document.getElementById('fileInput');
                //We charge the json when we pass in hidden champ the cache div.
                var fileCache = document.getElementById('cache');
                fileInput.addEventListener('change', function (e) {

                    //We display the name of the file in the place "ulpoadFile"
                    document.getElementById("uploadFile").value = fileInput.value;
                    var file = fileInput.files[0];
                    var reader = new FileReader();
                    reader.onload = function (e) {

                        var jsonObj = reader.result;
                        fileCache.innerHTML = jsonObj;
                    };
                    reader.readAsText(file);
                }


                );
                ;
            };

            //Buttons
            function buttons() {
                document.getElementById('start').value = loadOk;
                document.getElementById('uploadFile').placeholder = fileSelect;
            }

            var language = "assets/audio/fr/";
            soundManager.onload = function () {
                sound0 = soundManager.createSound({id: "click0", url: language + "click.mp3", onfinish: function () {
                        self.location.href = 'index.html'
                    }});
            }

        </script>
        <link rel="stylesheet" type="text/css" href="css/loadStyle.css">
    </head>

    <body onload="buttons();">
        <img src="assets/images/load/wallpaper.png"  />
        <div id="menu">
            <input type="button" class="menuButton" id="home" value=" " onclick="sound0.play();"/>
            <input type="button" class="menuButton" id="mute" value=" "/>
        </div>
    <center><div id="json">


            <div class="inputBtnSection">
                <input id="uploadFile" class="disableInputField" placeholder="" disabled="disabled" />

                <label class="fileUpload">
                    <input id="fileInput" type="file" class="upload" />
                    <span class="uploadBtn">...</span>
                </label>
            </div>

            <br><br><br><br>
            <input type="button" id="start" value="" onclick="checkExtension();">
        </div>

        <h3 class="cache" id="cache"> </h3>
    </center>
    <div id="final">

        <img id="patrick" src="assets/images/final/patrick.png" alt="patrick"/>
        <div id="buttons">
            <input type="button" class="menuButton" id="home" value=" " onclick="clickerHome()"/>
            <input type="button" class="menuButton" id="mute" value=" "/>
            <br/>
            <input id="importButton" type="button" value="" onclick="self.location.href = 'load.html'"/>
        </div>

    </div>
</body>

</html>