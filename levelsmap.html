<!doctype html> 
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <title>/-> PatriMath <-/</title>
        <link rel="stylesheet" type="text/css" href="css/levelsMapStyle.css">
        <script type="text/javascript" src="library/soundmanager2.js"></script>
        <script type="text/javascript" src="script/data/fr_buttons.js"></script>

        <script>
/////////////////////////////////////////////////////////////

            //Function to verify the extension 
            function checkExtension() {
                var fileInput = document.getElementById('fileInput');
                var myString = fileInput.value;
                var myExt = myString.substring(myString.lastIndexOf(".") + 1, myString.length);
                myExt = myExt.toLowerCase();
                //Error message if it is not a JSON
                if (myExt !== "json") {
                    alert(errorLoad);
                } else {
                    if(document.getElementById('cache').innerText == ""){
                        alert(errorEmptyJson);
                    } else {                        
                        //If it is good, we launch the game
                        self.location.href = "load.html?leveltext=" + document.getElementById('cache').innerText;
                    }
                }
            }


            //Load JSON file
            
            function loadJsonFile() {
                var fileInput = document.getElementById('fileInput');
                var fileCache = document.getElementById('cache');
                var filePlaceholder = document.getElementById('uploadFile');
                
                if ('files' in fileInput) {
                    if (fileInput.files.length > 0) {
                        filePlaceholder.value = fileInput.files[0].name
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            fileCache.innerHTML = reader.result;
                        };
                        reader.readAsText(fileInput.files[0]);
                   }
                } 
            }
            
            // Level Sounds
            var language = "assets/audio/fr/";
            var canPlay = false;

            soundManager.onload = function () {
                sound_home = soundManager.createSound({id: "clickhome", url: language + "click.mp3", onfinish: function () {self.location.href = 'index.html';}});
                sound_mute = soundManager.createSound({id: "clickmute", url: language + "click.mp3"});
                sound = soundManager.createSound({id: "click", url: language + "click.mp3"});
                sound_locked = soundManager.createSound({id: "clicklock", url: language + "locked.mp3"});
                imports = soundManager.createSound({id : "imports", url: language+"import.mp3",onfinish: function(){ canPlay=true;}});
                introduction = soundManager.createSound({id : "introduction", url: language+"introduction.mp3",onfinish: function(){ canPlay=true;},autoPlay:true});
            }

            function sound_level(i) {
                var element = document.getElementById(i);
                if (element.className == 'levelButton') {
                    sound.options.onfinish = function () {
                        self.location.href = "level.html?levelnum=" + i;
                    };
                    sound.play();
                } else {
                    sound_locked.play();
                }
            }

            function playing(son){
                if (canPlay){
                    canPlay = false;
                    son.play();
                }
			}
            
            function mute(){
                if (!soundManager.muted){
                    soundManager.mute();
                    document.getElementById("mute").id="muteon";
                }else{
                    soundManager.unmute();
                    sound_mute.play();
                    document.getElementById("muteon").id="mute";
                }
            }
            
            for (ii=1;ii <= 35;ii++){
                document.getElementById(ii).addEventListener('touchend', function(e){sound_level(ii)}, false);
            }
            
            //Buttons
            function buttons() {
                document.getElementById('importButton').value = problemImport;
                document.getElementById('start').value = loadOk;
                document.getElementById('uploadFile').placeholder = fileSelect;
            }
        </script>

    </head>
    <body onload="buttons();">
        <img id="wallpaper" src="assets/images/levels/wallpaper.png" alt="wallpaper"/>
        <div id="menu">
            <input type="button" class="menuButton" id="home" value=" " onclick="sound_home.play();"/>
           
            <input type="button" class="menuButton" id="mute" value=" " onclick="mute();"/>
        </div>

        <div id="buttons_container">
            <div id="levels">
                <input id="1" type="button" class="levelButton" value="1" onclick= "sound_level('1');" />
                <input id="2" type="button" class="levelButton" value="2" onclick= "sound_level('2');" />
                <input id="3" type="button" class="levelButton" value="3" onclick= "sound_level('3');"/>
                <input id="4" type="button" class="levelButton" value="4" onclick= "sound_level('4');"/>
                <input id="5" type="button" class="levelButton" value="5" onclick= "sound_level('5');"/>          
                <input id="6" type="button" class="levelButton" value="6" onclick= "sound_level('6');"/>
                <input id="7" type="button" class="levelButton" value="7" onclick= "sound_level('7');"/>
                <input id="8" type="button" class="levelButton" value="8" onclick= "sound_level('8');"/>
                <input id="9" type="button" class="levelButton" value="9" onclick= "sound_level('9');"/>
                <input id="10" type="button" class="levelButton" value="10" onclick= "sound_level('10');"/>           
                <input id="11" type="button" class="levelButton" value="11" onclick= "sound_level('11');"/>
                <input id="12" type="button" class="levelButton" value="12" onclick= "sound_level('12');"/>
                <input id="13" type="button" class="levelButton" value="13" onclick= "sound_level('13');"/>
                <input id="14" type="button" class="levelButton" value="14" onclick= "sound_level('14');"/>
                <input id="15" type="button" class="levelButton" value="15" onclick= "sound_level('15');"/>
                <input id="16" type="button" class="levelButton" value="16" onclick= "sound_level('16');"/>
                <input id="17" type="button" class="levelButton" value="17" onclick= "sound_level('17');"/>
                <input id="18" type="button" class="levelButton" value="18" onclick= "sound_level('18');"/>
                <input id="19" type="button" class="levelButton" value="19" onclick= "sound_level('19');"/>
                <input id="20" type="button" class="levelButton" value="20" onclick= "sound_level('20');"/>
                <input id="21" type="button" class="levelButton" value="21" onclick= "sound_level('21');"/>
                <input id="22" type="button" class="levelButton" value="22" onclick= "sound_level('22');"/>
                <input id="23" type="button" class="levelButton" value="23" onclick= "sound_level('23');"/>
                <input id="24" type="button" class="levelButton" value="24" onclick= "sound_level('24');"/>
                <input id="25" type="button" class="levelButton" value="25" onclick= "sound_level('25');"/>
                <input id="26" type="button" class="levelButton" value="26" onclick= "sound_level('26');"/>
                <input id="27" type="button" class="levelButton" value="27" onclick= "sound_level('27');"/>
                <input id="28" type="button" class="levelButton" value="28" onclick= "sound_level('28');"/>
                <input id="29" type="button" class="levelButton" value="29" onclick= "sound_level('29');"/>
                <input id="30" type="button" class="levelButton" value="30" onclick= "sound_level('30');"/>
                <input id="31" type="button" class="levelButton" value="31" onclick= "sound_level('31');"/>
                <input id="32" type="button" class="levelButton" value="32" onclick= "sound_level('32');"/>
                <input id="33" type="button" class="levelButton" value="33" onclick= "sound_level('33');"/>
                <input id="34" type="button" class="levelButton" value="34" onclick= "sound_level('34');"/>
                <input id="35" type="button" class="levelButton" value="35" onclick= "sound_level('35');"/>

            </div>
            <div id="importation">

            <input type="button" id="importButton" class="importButton" value="" onmouseover="playing(imports);" onclick="this.style.display='none';document.getElementById('json').style.display='block';" /> 
            <div id="json">
                <input type="button" id="start" class="importButton" value="" onclick="checkExtension();">
                <div class="inputBtnSection">
                    <input id="uploadFile" class="disableInputField" placeholder="" disabled="disabled" />

                    <label class="fileUpload">
                        <input id="fileInput" type="file" class="upload" onchange="loadJsonFile()" />
                        <span class="uploadBtn">...</span>
                    </label>
                </div>
            </div>

            <h3 class="cache" id="cache"> </h3> 
            </div>
        </div>
    </body>
</html>